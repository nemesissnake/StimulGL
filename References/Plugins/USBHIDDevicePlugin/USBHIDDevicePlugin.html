<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../../css/Default.css" rel="stylesheet" type="text/css" />
<link href="../../../google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
<script src="../../../js/jquery.min.js" type="text/javascript"></script>
<script src="../../../js/jquery.tableofcontents.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/StimulGL.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../google-code-prettify/prettify.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
	var StimulGLInfo = new StimulGL_Information();
	var DocTitle = StimulGLInfo.GetDocumentTitle(window.location.pathname);	
	$(document).ready(function()
		{ 
			$("#toc").tableOfContents(
				$("#toc_Area"),// Scoped to div#toc_Area
				{
					startLevel: 2,// H2 and up
					depth:4,// H2 through H5,
				}
			); 
			prettyPrint();			
		}
	);
	document.write("<title>" + DocTitle + "</title>");	
</script>
</head>
<body>
<script type="text/javascript">StimulGLInfo.GetDocumentHeader(window.location.pathname)</script>
<div id="toc_Area">
<ul id="toc"></ul>
<h2>Introduction </h2>
<p> The USBHID (USB Human Interface Device) Device Plug-in was originally written to create an fast direct interface between StimulGL and a optical joystick connected to a hardware device with a USB connection from <a href="http://www.curdes.com/" target="_blank">http://www.curdes.com/</a>. The USBHID plug-in can also be seen as an example of how to create/implement a custom Device plug-in for StimulGL. The plug-in extends the StimulGL script engine and implement a User Interface that can be accessed trough the StimulGL plug-ins menu. This User Interface is also used inside this document to describe all the capabilities.<br />
The plug-in can calibrate/capture/filter and log the captured data. Furthermore it’s possible to emulate a standard mouse with the Joystick position; this makes it easy to use the device in any Stimuli presentation software like E-prime/Presentation by running the plug-in parallel as a separate thread.</p>
<h2>Hardware</h2>
<p>The USBHID Device Plug-in can capture the data-stream trough a USB connection from an HID hardware device. This data-stream is then parsed by the plug-in which expects the data-stream to be encoded with the use of a per defined protocol. Because this protocol is not universal we probably cannot use this plug-in to read other USB HID hardware than those who are using the manufacturers defined protocol (Programmers Joystick) at <a href="http://www.curdes.com/index.php/technical/Manual-005" target="_blank">http://www.curdes.com/index.php/technical/Manual-005</a>.</p>
<h3>Data-stream protocol</h3>
<p>With the rotary switch set to position 5 (<em>Programmers Joystick</em>), the output from the fORP interface is:</p>
<ul>
  <li>higher baud (57600)</li>
  <li>higher resolution (11 bits in x and y direction)</li>
  <li>not compatible with standard built-in drivers (such as MOUSE.SYS).</li>
</ul>
<p>In this mode 4 bytes are sent continuously. The packet structure is as follows:</p>
<table cellpadding="0" cellspacing="0" class="paramtable">
  <tbody>
    <tr>
      <th><p>Byte</p></td>
      <th><p>d7</p></td>
      <th><p>d6</p></td>
      <th><p>d5</p></td>
      <th><p>d4</p></td>
      <th><p>d3</p></td>
      <th><p>d2</p></td>
      <th><p>d1</p></td>
      <th><p>d0</p></td>
    </tr>
    <tr>
      <td><p>1</p></td>
      <td><p>1</p></td>
      <td><p>Left button</p></td>
      <td><p>Middle button</p></td>
      <td><p>Right button</p></td>
      <td><p>y10</p></td>
      <td><p>y9</p></td>
      <td><p>y8</p></td>
      <td><p>y7</p></td>
    </tr>
    <tr>
      <td><p>2</p></td>
      <td><p>0</p></td>
      <td><p>x6</p></td>
      <td><p>x5</p></td>
      <td><p>x4</p></td>
      <td><p>x3</p></td>
      <td><p>x2</p></td>
      <td><p>x1</p></td>
      <td><p>x0</p></td>
    </tr>
    <tr>
      <td><p>3</p></td>
      <td><p>0</p></td>
      <td><p>y6</p></td>
      <td><p>y5</p></td>
      <td><p>y4</p></td>
      <td><p>y3</p></td>
      <td><p>y2</p></td>
      <td><p>y1</p></td>
      <td><p>y0</p></td>
    </tr>
    <tr>
      <td><p>4</p></td>
      <td><p>0</p></td>
      <td><p>0</p></td>
      <td><p>0</p></td>
      <td><p>0</p></td>
      <td><p>x10</p></td>
      <td><p>x9</p></td>
      <td><p>x8</p></td>
      <td><p>x7</p></td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h2>Standard Usage</h2>
<p>The following sub-chapters describe the steps for a default usage of the plug-in.</p>
<h3>Connection and calibration</h3>
<p>
First we need to connect and roughly calibrate (1st calibration step) the optical joystick because the optical cable signal signal strength may vary over time. Before we can roughly calibrate the joystick we have to make sure that the optical joystick is connected to the optical extension cable and that the joysticks shaft is centered and stays in this position during this first rough calibration, see below picture:</p>
<p><img src="images/image02.jpg" alt=""/></p>
<p>Now we con connect the optical extension cable to the electronic interface box:</p>
<p><img src="images/image03.jpg" alt=""/></p>
<p>Make sure that the Electronic Interface Mode Selection Wheel is positioned at number 5:</p>
<p><img src="images/image04.png" alt=""/></p>
<p>Connect the USB cable from the Electronic Interface to the Stimuli PC:</p>
<p><img src="images/image05.jpg" alt=""/></p>
<p>Disconnect (if not yet disconnected) the Power supply from the Electronic Interface (see above picture), and connect it back again; the Electronic Interface roughly then calibrates the device automatically during power start-up (first 2 seconds). Now all the cable connections and the first rough calibration is done.<br />
Now we need to check whether communication between the joystick and the program is possible. To do this first start by opening the plug-ins User Interface:</p>
<p><img src="images/image00.png" alt=""/></p>
<p>We start with entering the correct Vendor and Product ID, these fields are already filled-in with the default and probably correct “Vendor ID” and “Product ID”. To check whether these values are correct we can check this on a Windows OS by:</p>
<ol>
  <li>  opening the System Properties and</li>
  <li>  go to the Device Manager,</li>
  <li> open the USB HID Device and open the Properties,</li>
  <li> click on the Details tab,</li>
  <li> select Device Instance ID and check the VID and PID value from the string, see below picture:</li>
</ol>
<p><img src="images/image01.jpg" alt=""/></p>
<p>Now we have everything setup to start the capture thread and read the joysticks position. Press the “Capture” button once. The programs state label should change from Pending…to HID Communication Active… Check/validate that the captured data is changing inside the “Captured data” frame when moving the joystick (only changes are captured). Press the “Stop” button, the programs status changes again back to Pending…The communication is now fully working and now we can further calibrate (step 2)the joystick. This (software) calibration captures the joysticks position and uses it to define the range of the joystick position (Min, Max and center point).<br />
Select the “Show Data in Graph” and the “Show Full screen reference Lines” check-box, to show the results of the joystick movement inside a graph together with some reference lines. Select the “Enable Calibration” button, its back color turns green meaning that the calibration is now active! Press the “Capture” button again, the programs state changes from Pending…to HID Communication Active…in the status bar.<br />
During this active calibration the plug-in reads the optical joystick data stream (X, Y position and button presses) and adapts the minimal and maximal value for X and Y found (see Calibration frame) during (calibration) capture. It’s therefore important to move the joystick during this calibration to the most/fully outer corners! The plug-in then stores these new calibration values in memory (it remains in memory as long the plug-in is open). To reset/clear the calibration data from memory you can press the Reset Calibration button.<br />
During the calibration process you’ll notice that the small box inside the Graph (Graphical frame) moves together with the movement of the joystick. When the joystick is fully calibrated the joystick can move inside a circular area until the corners of the rectangle.</p>
<p><img src="images/image06.png" alt=""/></p>
<p>If the joystick is fully calibrated you can click the “Enable Calibration” button again to disable the calibration, the calibrated settings remain in memory as long the plug-in is running.<br />
Press the “Stop” button to stop the capture thread again. By now the joystick is ready for use.<br />
</p>
<h3>Mouse Emulation</h3>
<p>If you want to activate the mouse (only xy-pointer at this release) emulation (during an active capture thread, see previous chapter) you should check the “Enable Mouse Emulation”. Because the joystick then interferes with the mouse movement you can press the keyboards “Escape” key again to disable this option/emulation.<br />
The “Full screen mode” makes it possible to even point the mouse arrow to the outer corners of the screen trough mouse emulation with the optical joystick. This is possible because the circular movement area is the recalculated to fit around the rectangular screen area. If not set then only a circular area within the screen area can be covered with the mouse pointer. Full screen mode is also represented by the inner reference box inside the graph.</p>
<h3>Data Filtering</h3>
<p>To create a smooth transition of the movement of the mouse pointer you can check the “Enable Low Pass Filter” check-box. This enables the plug-ins low pass filtering capabilities by keeping track of a history of an amount of “History Size” captured records and use these to mean the X/Y signal to create a smooth transition.<br />
Because the signal to noise ration of the optical joystick signal is pretty poor you may also select the “Enable Stabilization” check-box which will ignore minor captured movements over time (that occur due to the high noise level) and keep the mouse pointer at it’s current position. The threshold position is the amount of steps from a 11-bit signal (in the X and Y position of the joystick) which is ignored for the mouse emulation.</p>
<h3>Data logging</h3>
<p>You can also enable the data logging feature which writes the captured data to a log file for further usage. The Write Header option makes sure that the first line in this (tab delimited) file is a name header, making it easier to understand how the data is ordered. Write calibrated data writes the data after has been calibrated with all the current settings.</p>
</div>
</body>
</html>
